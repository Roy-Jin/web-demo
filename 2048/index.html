<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <link rel="stylesheet" href="./doc/style.css">
    </link>
    <title>2048</title>
</head>

<body>
    <div class="wrapper">
        <div class="header">
            <div class="title">
                <h3 class="name">2048</h3>
                <div class="score-area">
                    <div class="score">
                        <span class="label">å·²å¾—åˆ†</span>
                        <span class="value">0</span>
                    </div>
                    <div class="best">
                        <span class="label">æœ€é«˜åˆ†</span>
                        <span class="value">0</span>
                    </div>
                </div>
            </div>
            <div class="btn">
                <div class="change-bgColor">ğŸ¨</div>
                <div class="new-game-btn">é‡ç½®</div>
            </div>
        </div>
        <div class="game-area">
            <div id="game-start">å¼€å§‹å§</div>
            <div id="board">
                <div class="board-box"></div>
                <div class="game-over">
                    <div class="label">æ¸¸æˆç»“æŸ!</div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">ã€Œ2048ã€ç®—æ³•ç”±<span id="link">Roy-Jin</span>ç¼–å†™å¹¶æä¾›æ”¯æŒ.</div>
</body>

<!-- Script files -->
<script src="./doc/ColorMap.js"></script>
<script src="./doc/Cell.js"></script>
<script src="./doc/CellBorder.js"></script>
<script src="./doc/Game.js"></script>
<script>
    // ç¼“å­˜æ•°æ®
    const cacheKey = 'BEST_SCORE_2048';
    const cacheColor = 'CACHE_COLOR_2048';

    window.onload = function () {
        document.querySelector('.best .value').innerText = localStorage.getItem(cacheKey) || 0;

        // windowåŠ è½½å®Œæˆåï¼Œåˆ›å»ºæ¸¸æˆå¯¹è±¡
        document.querySelector("#game-start").addEventListener("click", function (e) {
            e.currentTarget.style.display = "none";
            document.querySelector("#board").style.display = "block";
            document.documentElement.style.setProperty('--board-bg', localStorage.getItem(cacheColor));
            const game = new Game([4, 4], cacheKey);
        })

        // åˆ‡æ¢é…è‰²
        document.querySelector(".change-bgColor").addEventListener("click", function (e) {
            // å¼¹å‡ºé¢œè‰²é€‰æ‹©æ¡†
            const input = document.createElement("input");
            input.type = "color";
            input.value = localStorage.getItem(cacheColor) || "#816311";
            input.addEventListener("input", function (e) {
                document.documentElement.style.setProperty('--board-bg', e.target.value);
            });
            input.addEventListener("change", function (e) {
                if (!confirm("æ˜¯å¦åº”ç”¨è¯¥é…è‰²ï¼Ÿ")) {
                    document.documentElement.style.setProperty('--board-bg', localStorage.getItem(cacheColor));
                    // å–æ¶ˆé€‰æ‹©ï¼Œæ¢å¤é»˜è®¤é…è‰²
                    // localStorage.setItem(cacheColor, "#816311");
                    // document.documentElement.style.setProperty('--board-bg', "#816311");
                } else {
                    localStorage.setItem(cacheColor, e.target.value);
                }
                input.remove();
            });
            input.click();
        });
    }
</script>

</html>