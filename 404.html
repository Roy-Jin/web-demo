<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link rel="icon" type="image/x-icon" href="/ForMe/avatar.ico">
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --text-color: #333;
      --bg-color: #f8f9fa;
      --card-bg: #fff;
      --border-radius: 8px;
      --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] {
      --primary-color: #4895ef;
      --secondary-color: #4361ee;
      --text-color: #f8f9fa;
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: all 0.3s ease-in-out;
      -webkit-tap-highlight-color: transparent;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    #app {
      max-width: 1200px;
      margin: 0 auto;
    }

    .theme-toggle {
      text-align: right;
    }

    #theme-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
    }

    .path-bar {
      margin-bottom: 20px;
      font-size: 1.1rem;
    }

    .path-bar a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color 0.2s;
    }

    .path-bar a:hover {
      color: var(--secondary-color);
      text-decoration: underline;
    }

    .file-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }

    .file-item {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .file-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }

    .file-item a {
      display: block;
      padding: 15px;
      color: var(--text-color);
      text-decoration: none;
    }

    .file-info {
      color: #666;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .file-list {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
      }
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="theme-toggle">
      <button id="theme-toggle">‚òÄÔ∏è</button>
    </div>
    <div class="path-bar"></div>
    <div class="file-list"></div>
  </div>
  <script>
    function render(fullTree) {
      const pathBar = app.querySelector('.path-bar');
      const fileList = app.querySelector('.file-list');

      // Ëé∑ÂèñÂΩìÂâçË∑ØÂæÑ
      const decodedPath = decodeURIComponent(window.location.pathname);
      const fullPath = decodedPath.replace(/^\/|\/$/g, '').split('/');
      const currentNode = fullPath[fullPath.length - 1];
      document.title = `(WEB)/${fullPath.join('/')}`;
      // console.log({ fullPath, currentNode });

      // Êü•ÊâæÊåáÂÆöË∑ØÂæÑÁöÑËäÇÁÇπ
      const findNode = (fullPath) => {
        if (!fullPath || fullPath.length === 0 || !fullTree) {
          return null;
        }

        // ‰ªéÊ†πËäÇÁÇπÂºÄÂßãÊü•Êâæ
        let currentNode = fullTree.find(node => node.name === fullPath[0]);
        if (!currentNode) {
          return null;
        }

        // ÈÄíÂΩíÊü•ÊâæÂ≠êËäÇÁÇπ
        for (let i = 1; i < fullPath.length; i++) {
          const nextName = fullPath[i];
          if (!currentNode.children) {
            return null;
          }
          currentNode = currentNode.children.find(child => child.name === nextName);
          if (!currentNode) {
            return null;
          }
        }

        return currentNode;
      }

      // Ëã•ÁõÆÂΩï‰∏çÂ≠òÂú®ÂàôË∑≥ËΩ¨Âà∞ÊúÄËøëÁöÑÁõÆÂΩï
      if (currentNode && !findNode(fullPath)) {
        for (let i = fullPath.length - 1; i >= 0; i--) {
          if (fullPath.length === 1) return window.location.replace('/');
          const newPath = fullPath.slice(0, i);
          const newNode = findNode(newPath);
          if (newNode) {
            window.location.replace(`/${newPath.join('/')}`);
            return;
          }
        }
        return;
      }

      // Ê∏≤ÊüìË∑ØÂæÑÊ†è
      const renderPathBar = (fullPath) => {
        pathBar.innerHTML =
          `<a href="/">(WEB)</a> \/ ` +
          fullPath.map((p, i) => `<a href="/${fullPath.slice(0, i + 1).join('/')}">${p}</a>`).join(' \/ ');
      };

      // Ê∏≤ÊüìÊñá‰ª∂ÂàóË°®
      const renderFileList = (fullTree => {
        const files = findNode(fullPath)?.children || fullTree;

        if (files.length === 0) {
          fileList.innerHTML = '<div class="file-info">üìÅ Á©∫ÁõÆÂΩï</div>';
          return;
        }

        fileList.innerHTML =
          files.map(file => {
            file.path = file.path.replace(/\\/g, '/');
            if (file.type === 'directory') {
              return `<div class="file-item directory">
                      <a href="/${file.path}">üìÅ ${file.name}</a>
                    </div>`;
            } else {
              return `<div class="file-item file">
                      <a href="/${file.path}" target="_blank">üìÑ ${file.name}</a>
                    </div>`;
            }
          }).join('');
      });

      renderPathBar(fullPath);
      renderFileList(fullTree);

    }

    function toggleTheme() {
      const html = document.documentElement;
      const themeToggle = document.getElementById('theme-toggle');

      if (html.getAttribute('data-theme') === 'dark') {
        html.removeAttribute('data-theme');
        themeToggle.textContent = '‚òÄÔ∏è';
        localStorage.setItem('theme', 'light');
      } else {
        html.setAttribute('data-theme', 'dark');
        themeToggle.textContent = 'üåô';
        localStorage.setItem('theme', 'dark');
      }
    }

    window.onload = () => {
      // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑ‰∏ªÈ¢òËÆæÁΩÆ
      const savedTheme = localStorage.getItem('theme');
      const themeToggle = document.getElementById('theme-toggle');

      if (savedTheme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.textContent = 'üåô';
      }

      themeToggle.addEventListener('click', toggleTheme);

      fetch('/index.json')
        .then(r => r.json())
        .then(fullTree => render(fullTree));
    };
  </script>
</body>

</html>